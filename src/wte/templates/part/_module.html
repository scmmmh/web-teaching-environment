<article class="row left" xmlns:py="http://genshi.edgewall.org/">
  <section class="small-12 column">
    <div py:if="part.allow('edit', r.current_user) or part.allow('delete', r.current_user)" class="menu inline"><a href="#" class=""><img src="${r.static_url('wte:static/img/menu-icon.svg')}" alt="Menu"/></a>
      <ul>
        <py:if test="part.allow('edit', r.current_user)">
          <li py:if="part.status == 'unavailable'"><a href="${r.route_url('part.change_status', pid=part.id, _query=[('status', 'available')])}" class="post-link">Make Available</a></li>
          <li py:if="part.status == 'available'"><a href="${r.route_url('part.change_status', pid=part.id, _query=[('status', 'unavailable')])}" class="post-link">Make Unavailable</a></li>
          <li><a href="${r.route_url('part.edit', pid=part.id)}">Edit</a></li>
          <li class="divider"></li>
          <li><a href="${r.route_url('part.new', new_type='tutorial', _query=[('parent_id', part.id)])}">Add Tutorial</a></li>
          <li><a href="${r.route_url('part.new', new_type='exercise', _query=[('parent_id', part.id)])}">Add Exercise</a></li>
          <li><a href="${r.route_url('part.export', pid=part.id)}" class="post-link">Export</a></li>
          <li><a href="${r.route_url('part.import', _query=[('parent_id', part.id)])}">Import</a></li>
          <li class="divider"></li>
          <li><a href="${r.route_url('part.users', pid=part.id)}">Users</a></li>
        </py:if>
        <li class="divider"></li>
        <li py:if="part.allow('delete', r.current_user)"><a href="${r.route_url('part.delete', pid=part.id)}" class="alert post-link" data-wte-confirm="${h.frontend.confirm_delete('module', part.title, True)}">Delete</a></li>
      </ul>
    </div>
    <h1>${part.title}<small py:if="part.status == 'unavailable'" class="label radius">Unavailable</small></h1>
    ${h.Markup(part.compiled_content)}
    <section>
      <ul class="no-symbol">
        <li py:for="child in part.children" py:if="child.allow('view', r.current_user)" class="panel clearfix status-${child.status}">
          <div py:if="child.allow('edit', r.current_user) or child.allow('delete', r.current_user)" class="menu inline"><a href="#" class=""><img src="${r.static_url('wte:static/img/menu-icon.svg')}" alt="Menu" class="small"/></a>
            <ul>
              <py:if test="child.allow('edit', r.current_user)">
                <li py:if="child.status == 'unavailable'"><a href="${r.route_url('part.change_status', pid=child.id, _query=[('status', 'available')])}" class="post-link">Make Available</a></li>
                <li py:if="child.status == 'available'"><a href="${r.route_url('part.change_status', pid=child.id, _query=[('status', 'unavailable')])}" class="post-link">Make Unavailable</a></li>
                <li><a href="${r.route_url('part.edit', pid=child.id)}">Edit</a></li>
                <li class="divider"></li>
                <li><a href="${r.route_url('part.export', pid=child.id)}" class="post-link">Export</a></li>
                <li><a href="${r.route_url('part.import', _query=[('parent_id', child.id)])}">Import</a></li>
              </py:if>
              <li class="divider"></li>
              <li><a py:if="child.allow('delete', r.current_user)" href="${r.route_url('part.delete', pid=child.id)}" class="alert post-link" data-wte-confirm="${h.frontend.confirm_delete(child.type, child.title, True)}">Delete</a></li>
            </ul>
          </div>
          <h3><a href="${r.route_url('part.view', pid=child.id)}">${child.title}</a><small py:if="child.status == 'unavailable'" class="label radius">Unavailable</small></h3>
          ${h.frontend.part_summary(child)}
        </li>
      </ul>
    </section>
    <div>
      <a py:if="not part.has_role(['student', 'owner'], r.current_user)" href="${r.route_url('part.register', pid=part.id)}" class="button small">Register</a>
      <a py:if="part.has_role('student', r.current_user)" href="${r.route_url('part.deregister', pid=part.id)}" class="button small">De-register</a>
    </div>
  </section>
  <script>
  $('.menu').dropdownMenu();
  </script>
</article>