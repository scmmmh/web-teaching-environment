<!DOCTYPE html>
<html xmlns:py="http://genshi.edgewall.org/" xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="../layout/layout.html"/>
  <head>
    <title>${title}</title>
  </head>
  <body>
    <div class="row left">
      <article class="small-12 column">
        <h1>${title}</h1>
        <ul class="no-symbol">
          <li py:if="not modules" class="panel callout">${missing}</li>
          <li py:for="part in modules" class="panel clearfix status-${part.status if part.type != 'project' else 'available'}">
            <ul py:if="part.allow('edit', r.current_user) or part.allow('delete', r.current_user)" class="right menubar">
              <li py:if="part.allow('edit', r.current_user) and part.type != 'project' and part.status == 'unavailable'"><a href="${r.route_url('part.change_status', pid=part.id, _query=[('status', 'available'), ('return_to', r.current_route_url())])}" class="post-link" title="Make Available"><span class="fi-unlock"></span></a></li>
              <li py:if="part.allow('edit', r.current_user) and part.type != 'project' and part.status == 'available'"><a href="${r.route_url('part.change_status', pid=part.id, _query=[('status', 'unavailable'), ('return_to', r.current_route_url())])}" class="post-link" title="Make Unavailable"><span class="fi-lock"></span></a></li>
              <li py:if="part.allow('edit', r.current_user)"><a href="${r.route_url('part.edit', pid=part.id)}" title="Edit"><span class="fi-pencil"></span></a></li>
              <li py:if="part.allow('edit', r.current_user)">
                <div class="menu"><a href="#" title="Add Content"><span class="fi-plus"></span></a>
                  <ul>
                    <li><a href="${r.route_url('part.new', new_type='tutorial', _query=[('parent_id', part.id)])}">Add Tutorial</a></li>
                    <li><a href="${r.route_url('part.new', new_type='exercise', _query=[('parent_id', part.id)])}">Add Exercise</a></li>
                  </ul>
                </div>
              </li>
              <li>
                <div class="menu"><a href="#" title="Menu"><span class="fi-list"></span></a>
                  <ul>
                    <py:if test="part.allow('edit', r.current_user)">
                      <py:if test="part.type != 'project'">
                        <li py:if="part.status == 'unavailable'"><a href="${r.route_url('part.change_status', pid=part.id, _query=[('status', 'available')])}" class="post-link">Make Available</a></li>
                        <li py:if="part.status == 'available'"><a href="${r.route_url('part.change_status', pid=part.id, _query=[('status', 'unavailable')])}" class="post-link">Make Unavailable</a></li>
                      </py:if>
                      <li><a href="${r.route_url('part.edit', pid=part.id)}">Edit</a></li>
                      <li class="divider"></li>
                      <py:if test="part.type != 'project'">
                        <li><a href="${r.route_url('part.new', new_type='tutorial', _query=[('parent_id', part.id)])}">Add Tutorial</a></li>
                        <li><a href="${r.route_url('part.new', new_type='exercise', _query=[('parent_id', part.id)])}">Add Exercise</a></li>
                      </py:if>
                      <li><a href="${r.route_url('part.export', pid=part.id)}" class="post-link">Export</a></li>
                      <py:if test="part.type != 'project'">
                        <li><a href="${r.route_url('part.import', _query=[('parent_id', part.id)])}">Import</a></li>
                        <li class="divider"></li>
                        <li><a href="${r.route_url('part.users', pid=part.id)}">Users</a></li>
                      </py:if>
                    </py:if>
                    <li class="divider"></li>
                    <li py:if="part.allow('delete', r.current_user)"><a href="${r.route_url('part.delete', pid=part.id)}" class="alert post-link" data-wte-confirm="${h.frontend.confirm_delete(part.type, part.title, True)}">Delete</a></li>
                  </ul>
                </div>
              </li>
            </ul>
            <h3>
              <a py:if="part.allow('view', r.current_user)" href="${r.route_url('part.view', pid=part.id)}">${part.title}</a>
              <span py:if="not part.allow('view', r.current_user)">${part.title}</span>
              <small py:if="part.type != 'project' and part.status == 'unavailable'" class="label radius">Unavailable</small>
            </h3>
            ${h.frontend.part_summary(part)}
          </li>
        </ul>
        <div>
          <a py:if="r.current_user.has_permission('modules.create')" href="${r.route_url('part.import')}" class="button small">Import Module</a>
          <a py:if="r.current_user.has_permission('modules.create')" href="${r.route_url('part.new', new_type='module')}" class="button small">New Module</a>
          <a py:if="r.current_user.has_permission('projects.create')" href="${r.route_url('part.new', new_type='project')}" class="button small">New Project</a>
        </div>
      </article>
    </div>
    <script>
    $('.menu').dropdownMenu();
    </script>
  </body>
</html>