<article class="row left display-mode-text_only" xmlns:py="http://genshi.edgewall.org/">
  <section id="textbook" class="small-12 column rest">
    <div class="fixed-pagination">
      ${h.frontend.page_pagination(r, part)}
    </div>
    <div py:if="part.allow('edit', r.current_user) or part.allow('delete', r.current_user)" class="right">
      ${h.frontend.menubar([
        {'group': 'edit', 'items': [
          {'visible': part.allow('edit', r.current_user),
           'icon': 'fi-pencil',
           'label': 'Edit',
           'href': r.route_url('part.edit', pid=part.id),
           'highlight': True}]},
        {'group': 'add', 'items': [
          {'visible': part.allow('edit', r.current_user),
           'label': 'Add Template',
           'icon': 'fi-plus',
           'href': r.route_url('asset.new', pid=part.id, new_type='template'),
           'highlight': True},
          {'visible': part.allow('edit', r.current_user),
           'label': 'Add Asset',
           'icon': 'fi-plus',
           'href': r.route_url('asset.new', pid=part.id, new_type='asset'),
           'highlight': True}]},
        {'group': 'importexport', 'items': [
          {'visible': part.allow('edit', r.current_user),
           'label': 'Export',
           'href': r.route_url('part.export', pid=part.id),
           'class': 'post-link'}]},
        {'group': 'delete', 'items': [
          {'visible': part.allow('delete', r.current_user),
           'label': 'Delete',
           'href': r.route_url('part.delete', pid=part.id),
           'class': 'alert post-link',
           'confirm': h.frontend.confirm_delete(part.type, part.title, True)}]},
      ], drop_down_menu_left=False)}
    </div>
    <h1>${part.title}<small py:if="part.status == 'unavailable'" class="label radius">Unavailable</small></h1>
    ${Markup(part.compiled_content)}
    <section py:if="not part.has_role('student', r.current_user) and part.templates">
      <h2>Templates</h2>
      <ul class="no-symbol">
        <li py:for="template in part.templates" class="panel clearfix">
          <div py:if="part.allow('edit', r.current_user)" class="right">
            ${h.frontend.menubar([
              {'group': 'edit', 'items': [
                {'visible': True,
                 'icon': 'fi-pencil',
                 'label': 'Edit',
                 'href': r.route_url('asset.edit', pid=part.id, aid=template.id),
                 'highlight': True}]},
              {'group': 'delete', 'items': [
                {'visible': True,
                 'label': 'Delete',
                 'href': r.route_url('asset.delete', pid=part.id, aid=template.id),
                 'class': 'alert post-link',
                 'confirm': h.frontend.confirm_delete('template', template.filename, False)}]},
            ], drop_down_menu_left=False)}
          </div>
          <h3>${template.filename} (${template.mimetype})</h3>
        </li>
      </ul>
    </section>
    <section py:if="not part.has_role('student', r.current_user) and part.assets">
      <h2>Assets</h2>
      <ul class="no-symbol">
        <li py:for="asset in part.assets" class="panel clearfix">
          <div py:if="part.allow('edit', r.current_user)" class="right">
            ${h.frontend.menubar([
              {'group': 'edit', 'items': [
                {'visible': True,
                 'icon': 'fi-pencil',
                 'label': 'Edit',
                 'href': r.route_url('asset.edit', pid=part.id, aid=asset.id),
                 'highlight': True}]},
              {'group': 'delete', 'items': [
                {'visible': True,
                 'label': 'Delete',
                 'href': r.route_url('asset.delete', pid=part.id, aid=asset.id),
                 'class': 'alert post-link',
                 'confirm': h.frontend.confirm_delete('asset', asset.filename, False)}]},
            ], drop_down_menu_left=False)}
          </div>
          <h3><a href="${r.route_url('asset.view', pid=part.id, filename=asset.filename)}">${asset.filename} (${asset.mimetype})</a></h3>
        </li>
      </ul>
    </section>
    ${h.frontend.page_pagination(r, part)}
  </section>
  <script src="${r.static_url('wte:static/js/codemirror/codemirror.js')}"></script>
  ${h.frontend.codemirror_scripts(r, ['text/html'])}
  <script>
  $(document).ready(function() {
      $('.menu').dropdownMenu();
      $('.pagination').partPagination({scrolling: $(window)});
      $('.fixed-pagination').fixedPagination({global: true});
  });
  </script>
</article>