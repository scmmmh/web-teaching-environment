<!DOCTYPE html>
<html xmlns:py="http://genshi.edgewall.org/" xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="../layout/layout.html"/>
  <head>
    <title>${tutorial.title} - ${page.title}</title>
  </head>
  <body>
    <article class="rows">
      <section id="textbook" class="small-12 medium-6 large-4 column">
        <h1>${page.title}</h1>
        ${Markup(page.compiled_content)}
        <div class="pagination-centered">
          <ul class="pagination">
            <li py:if="not prev_page" class="disabled">Tutorial start</li>
            <li py:if="prev_page"><a href="${r.route_url('page.view', mid=module.id, tid=tutorial.id, pid=prev_page.id)}">&laquo; Previous page</a></li>
            <li class="current"><a href="${r.current_route_url()}">Page ${page_no} of ${len(tutorial.pages)}</a></li>
            <li py:if="not next_page" class="disabled">Next page &raquo;</li>
            <li py:if="next_page"><a href="${r.route_url('page.view', mid=module.id, tid=tutorial.id, pid=next_page.id)}">Next page &raquo;</a></li>
          </ul>
        </div>
      </section>
      <section id="editor" class="small-12 medium-6 large-8">
        <section id="files">
          <dl class="tabs" data-tab="">
            <dd py:for="idx, file in enumerate(progress.files)" class="${'active' if idx == 0 else ''}"><a href="#${h.frontend.html_id(file.filename)}">${file.filename}</a></dd>
          </dl>
          <form class="tabs-content">
            <div py:for="idx, file in enumerate(progress.files)" class="content ${'active' if idx == 0 else ''}" id="${h.frontend.html_id(file.filename)}">
              ${h.form.tags.textarea('', file.content, None, data_wte_mimetype=file.mimetype)}
            </div>
          </form>
        </section>
        <section id="viewer">
          <iframe src="/"></iframe>
        </section>
      </section>
    </article>
    <script src="${r.static_url('wte:static/js/codemirror/codemirror.js')}"></script>
    ${h.frontend.codemirror_scripts(r, ['text/html'])}
    <script>
    function resize_page() {
        var win_height = $(window).innerHeight();
        $('nav.top-bar').each(function() {
            win_height = win_height - $(this).outerHeight(true);
        });
        $('#textbook').css('height', win_height + 'px');
        $('#editor').css('height', win_height + 'px');
        $('#files').css('height', (win_height / 2) + 'px');
        $('#files .content').each(function() {
        	$(this).css('height', (win_height / 2) - $('#files .tabs').outerHeight(true) + 'px');
        });
        $('#viewer').css('height', (win_height / 2) + 'px');
    }
    $(document).ready(function() {
        resize_page();
        $(window).on('resize', resize_page);
        $('#files .content textarea').each(function() {
        	var textarea = $(this);
            textarea.data('wte-cm', CodeMirror.fromTextArea(this, {
            	mode: textarea.data('wte-mimetype')
            }));
        });
        $('#files .tabs').on('toggled', function (event, tab) {
        	tab.children('textarea').data('wte-cm').refresh();
        });
    });
    </script>
  </body>
</html>